// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Example models - customize based on your needs
model User {
  id                String    @id @default(uuid())
  email             String    @unique
  first_name        String?
  last_name         String?
  avatar            String?
  points_balance    Int       @default(0) // Points received (can spend)
  giving_budget     Int       @default(0) // Points can give (resets monthly)
  last_budget_reset DateTime?
  role              Role      @default(USER)
  department        String?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  // Relations
  kudos_sent     Kudo[]       @relation("KudoSender")
  kudos_received Kudo[]       @relation("KudoReceiver")
  reactions      Reaction[]
  redemptions    Redemption[]

  @@map("users")
}

model CoreValue {
  id          String   @id @default(uuid())
  name        String
  description String?
  emoji       String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  kudos Kudo[]

  @@map("core_values")
}

model Kudo {
  id            String    @id @default(uuid())
  sender_id     String
  receiver_id   String
  points        Int       @default(0)
  description   String?
  core_value_id String?
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  sender     User       @relation("KudoSender", fields: [sender_id], references: [id], onDelete: Cascade)
  receiver   User       @relation("KudoReceiver", fields: [receiver_id], references: [id], onDelete: Cascade)
  core_value CoreValue? @relation(fields: [core_value_id], references: [id], onDelete: SetNull)
  reactions  Reaction[]

  @@map("kudos")
}

model Reaction {
  id         String   @id @default(uuid())
  kudo_id    String
  user_id    String
  emoji      String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  kudo Kudo @relation(fields: [kudo_id], references: [id], onDelete: Cascade)
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([kudo_id, user_id, emoji])
  @@map("reactions")
}

model Reward {
  id          String   @id @default(uuid())
  name        String
  description String?
  points_cost Int
  image_url   String?
  stock       Int      @default(0)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  redemptions Redemption[]

  @@map("rewards")
}

enum RedemptionStatus {
  PENDING
  APPROVED
  FULFILLED
  CANCELLED
}

model Redemption {
  id           String           @id @default(uuid())
  user_id      String
  reward_id    String
  points_spent Int
  status       RedemptionStatus @default(PENDING)
  created_at   DateTime         @default(now())
  updated_at   DateTime         @updatedAt

  user   User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  reward Reward @relation(fields: [reward_id], references: [id], onDelete: Cascade)

  @@map("redemptions")
}

enum Role {
  USER
  ADMIN
  HR
}
